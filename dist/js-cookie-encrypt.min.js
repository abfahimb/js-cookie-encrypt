"use strict";
/*! js-cookie-encrypt v1.0.2 | MIT (c) 2024 Abdullah Al Fahim | https://github.com/abfahimb/js-cookie-encrypt */Object.defineProperty(exports,"__esModule",{value:!0}),exports.JsCookieEncrypt=void 0;
// Enhanced CookieCrypto class
class CookieCrypto{constructor(e){this.privateKey=e.privateKey,this.saltLength=e.saltLength||16}generateRandomSalt(){const e=new Uint8Array(this.saltLength);return window.crypto.getRandomValues(e),Array.from(e,(e=>String.fromCharCode(e))).join("")}expandKey(e,t){const o=[];for(let n=0;n<Math.max(null==e?void 0:e.length,null==t?void 0:t.length);n++){const s=e.charCodeAt(n%(null==e?void 0:e.length)),i=t.charCodeAt(n%(null==t?void 0:t.length));o.push(String.fromCharCode(s^i))}return o.join("")}xorEncryptDecrypt(e,t){const o=this.generateRandomSalt(),n=this.expandKey(t,o);let s="";for(let t=0;t<(null==e?void 0:e.length);t++)s+=String.fromCharCode(e.charCodeAt(t)^n.charCodeAt(t%(null==n?void 0:n.length)));return this.encodeToBase64(o+s)}encodeToBase64(e){return btoa(unescape(encodeURIComponent(e)))}decodeFromBase64(e){return decodeURIComponent(escape(atob(e)))}encrypt(e){return this.xorEncryptDecrypt(e,this.privateKey)}decrypt(e){const t=this.decodeFromBase64(e),o=t.substring(0,this.saltLength),n=t.substring(this.saltLength),s=this.expandKey(this.privateKey,o);let i="";for(let e=0;e<(null==n?void 0:n.length);e++)i+=String.fromCharCode(n.charCodeAt(e)^s.charCodeAt(e%(null==s?void 0:s.length)));return i}}
// Main JsCookieEncrypt class with enhanced features
class JsCookieEncrypt{constructor(e){var t;this.storageKey=e.storageKey,this.crypto=new CookieCrypto(e.cryptoConfig),this.defaultOptions=e.defaultOptions||{},this.encryptByDefault=null===(t=e.cryptoConfig.encryptByDefault)||void 0===t||t}set(e,t={},{encrypt:o,merge:n}={}){if("undefined"==typeof document)return;let s=e;if(n){const t=this.get()||{};s=Object.assign(Object.assign({},t),e)}const i=null!=o?o:this.encryptByDefault,r=Object.assign(Object.assign({},this.defaultOptions),t),a=i?this.crypto.encrypt(JSON.stringify(s)):JSON.stringify(s);let c=`${this.storageKey}=${a}`;
// Append cookie options in the same way as in the provided snippet
if(r.path&&(c+=`; path=${r.path}`),r.expires){c+=`; expires=${("number"==typeof r.expires?new Date(Date.now()+r.expires):r.expires).toUTCString()}`}r.domain&&(c+=`; domain=${r.domain}`),r.secure&&(c+="; secure"),r.sameSite&&(c+=`; samesite=${r.sameSite}`),r.httpOnly&&(c+="; httponly"),
// Set the cookie
document.cookie=c}
// Get value by nested path
getByPath(e){const t=this.get();return t?e.toString().split(".").reduce(((e,t)=>e&&e[t]),t):null}
// Set value by nested path
setByPath(e,t,o={}){const n=this.get()||{},s=e.toString().split(".");let i=n;for(let e=0;e<(null==s?void 0:s.length)-1;e++){const t=s[e];t in i||(i[t]={}),i=i[t]}i[s[(null==s?void 0:s.length)-1]]=t,this.set(n,o)}updateByPath(e,t,o={}){const n=this.get()||{},s=e.toString().split(".");let i=n;for(let e=0;e<(null==s?void 0:s.length)-1;e++){const t=s[e];t in i||(i[t]={}),i=i[t]}const r=s[(null==s?void 0:s.length)-1];r in i&&"object"==typeof i[r]&&"object"==typeof t?
// Merge the objects if the key exists and both are objects
i[r]=Object.assign(Object.assign({},i[r]),t):
// Otherwise, just set the value
i[r]=t,this.set(n,o)}deleteByPath(e){if("undefined"==typeof document)return;const t=this.get()||{},o=e.toString().split(".");let n=t;
// Traverse the path to get to the parent object
for(let e=0;e<o.length-1;e++){const t=o[e];if(!(t in n))return;// Path does not exist, nothing to delete
n=n[t]}const s=o[o.length-1];s in n&&(delete n[s],// Delete the field at the path
this.set(t))}
// Check if cookie exists
has(e){const t=this.get();return!!t&&(!e||
// Type guard to ensure `data` is an object
"object"==typeof t&&null!==t&&e in t)}
// Extend cookie expiration
extend(e,t={}){const o=this.get();o&&this.set(o,Object.assign(Object.assign({},t),{expires:new Date(Date.now()+1e3*e)}))}
// Get all cookies with same domain
static getAllCookies(e){const t={};return"undefined"==typeof document||document.cookie.split(";").forEach((o=>{const[n,s]=o.split("=").map((e=>e.trim()));e&&!o.includes(`domain=${e}`)||(t[n]=s)})),t}
// Clear all cookies with same domain
static clearAll(e,t="/"){const o=JsCookieEncrypt.getAllCookies(e);Object.keys(o).forEach((o=>{let n=`${o}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=${t}`;e&&(n+=`; domain=${e}`),document.cookie=n}))}clearAllCookies(){const e="localhost"===location.hostname,t=e?"":location.hostname.split(".").slice(-2).join(".");["/",""].forEach((o=>{document.cookie=`${this.storageKey}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${o};`,e||(document.cookie=`${this.storageKey}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${o}; domain=.${t};`)}))}
// Original methods with some enhancements
get(e){try{if("undefined"==typeof document)return null;const t=document.cookie.match(new RegExp("(^| )"+this.storageKey+"=([^;]+)")),o=t?t[2]:null;if(!o)return null;let n;return n=this.encryptByDefault?JSON.parse(this.crypto.decrypt(o)):JSON.parse(o),e&&n&&e in n?n[e]||null:n}catch(e){console.error("Failed to retrieve or parse cookie data:",e);const t=location.hostname.split("."),o=1===t.length&&"localhost"===t[0],n=o?"":t.length>1?t.slice(1).join("."):location.hostname;// Ensures cookies are cleared across different path levels
return["/",""].forEach((e=>{
// Clear for the current domain
document.cookie=`${this.storageKey}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${e};`,
// Clear for the root domain if not localhost
o||(document.cookie=`${this.storageKey}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=${e}; domain=.${n};`)})),null}}update(e,t={}){if("undefined"==typeof document)return;const o=this.get()||{},n=Object.assign(Object.assign({},o),e);this.set(n,t)}deleteFields(e){if("undefined"==typeof document)return;const t=this.get()||{};e.forEach((e=>delete t[e])),this.set(t)}clear(e={}){const t=Object.assign(Object.assign({},this.defaultOptions),e);let o=`${encodeURIComponent(this.storageKey)}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=${t.path||"/"}`;this.appendCookieOptions(o,t),document.cookie=o}
// Utility methods
appendCookieOptions(e,t){if(t.expires){e+=`; expires=${("number"==typeof t.expires?new Date(Date.now()+1e3*t.expires):t.expires).toUTCString()}`}return t.path&&(e+=`; path=${t.path}`),t.domain&&(e+=`; domain=${t.domain}`),t.secure&&(e+="; secure"),t.sameSite&&(e+=`; samesite=${t.sameSite}`),t.httpOnly&&(e+="; httponly"),e}}exports.JsCookieEncrypt=JsCookieEncrypt,exports.default=JsCookieEncrypt;
//# sourceMappingURL=js-cookie-encrypt.js.map