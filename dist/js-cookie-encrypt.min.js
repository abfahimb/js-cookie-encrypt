"use strict";
/*! js-cookie-encrypt v1.0.2 | MIT (c) 2024 Abdullah Al Fahim | https://github.com/abfahimb/js-cookie-encrypt */Object.defineProperty(exports,"__esModule",{value:!0}),exports.JsCookieEncrypt=void 0;class CookieCrypto{constructor(e){this.privateKey=e.privateKey,this.saltLength=e.saltLength||16}generateRandomSalt(){const e=new Uint8Array(this.saltLength);return window.crypto.getRandomValues(e),Array.from(e,(e=>String.fromCharCode(e))).join("")}expandKey(e,t){const n=[];for(let o=0;o<Math.max(null==e?void 0:e.length,null==t?void 0:t.length);o++){const s=e.charCodeAt(o%(null==e?void 0:e.length)),i=t.charCodeAt(o%(null==t?void 0:t.length));n.push(String.fromCharCode(s^i))}return n.join("")}xorEncryptDecrypt(e,t){const n=this.generateRandomSalt(),o=this.expandKey(t,n);let s="";for(let t=0;t<(null==e?void 0:e.length);t++)s+=String.fromCharCode(e.charCodeAt(t)^o.charCodeAt(t%(null==o?void 0:o.length)));return this.encodeToBase64(n+s)}encodeToBase64(e){return btoa(unescape(encodeURIComponent(e)))}decodeFromBase64(e){return decodeURIComponent(escape(atob(e)))}encrypt(e){return this.xorEncryptDecrypt(e,this.privateKey)}decrypt(e){const t=this.decodeFromBase64(e),n=t.substring(0,this.saltLength),o=t.substring(this.saltLength),s=this.expandKey(this.privateKey,n);let i="";for(let e=0;e<(null==o?void 0:o.length);e++)i+=String.fromCharCode(o.charCodeAt(e)^s.charCodeAt(e%(null==s?void 0:s.length)));return i}}class JsCookieEncrypt{constructor(e){var t;this.storageKey=e.storageKey,this.crypto=new CookieCrypto(e.cryptoConfig),this.defaultOptions=e.defaultOptions||{},this.encryptByDefault=null===(t=e.cryptoConfig.encryptByDefault)||void 0===t||t}set(e,t={},{encrypt:n,merge:o}={}){if("undefined"==typeof document)return;let s=e;if(o){const t=this.get()||{};s=Object.assign(Object.assign({},t),e)}const i=null!=n?n:this.encryptByDefault,r=Object.assign(Object.assign({},this.defaultOptions),t),a=i?this.crypto.encrypt(JSON.stringify(s)):JSON.stringify(s);let c=`${this.storageKey}=${a}`;if(r.path&&(c+=`; path=${r.path}`),r.expires){c+=`; expires=${("number"==typeof r.expires?new Date(Date.now()+r.expires):r.expires).toUTCString()}`}r.domain&&(c+=`; domain=${r.domain}`),r.secure&&(c+="; secure"),r.sameSite&&(c+=`; samesite=${r.sameSite}`),r.httpOnly&&(c+="; httponly"),document.cookie=c}getByPath(e){const t=this.get();return t?e.toString().split(".").reduce(((e,t)=>e&&e[t]),t):null}setByPath(e,t,n={}){const o=this.get()||{},s=e.toString().split(".");let i=o;for(let e=0;e<(null==s?void 0:s.length)-1;e++){const t=s[e];t in i||(i[t]={}),i=i[t]}i[s[(null==s?void 0:s.length)-1]]=t,this.set(o,n)}updateByPath(e,t,n={}){const o=this.get()||{},s=e.toString().split(".");let i=o;for(let e=0;e<(null==s?void 0:s.length)-1;e++){const t=s[e];t in i||(i[t]={}),i=i[t]}const r=s[(null==s?void 0:s.length)-1];r in i&&"object"==typeof i[r]&&"object"==typeof t?i[r]=Object.assign(Object.assign({},i[r]),t):i[r]=t,this.set(o,n)}deleteByPath(e){if("undefined"==typeof document)return;const t=this.get()||{},n=e.toString().split(".");let o=t;for(let e=0;e<n.length-1;e++){const t=n[e];if(!(t in o))return;o=o[t]}const s=n[n.length-1];s in o&&(delete o[s],this.set(t))}extend(e,t={}){const n=this.get();n&&this.set(n,Object.assign(Object.assign({},t),{expires:new Date(Date.now()+1e3*e)}))}static getAllCookies(e){const t={};return"undefined"==typeof document||document.cookie.split(";").forEach((n=>{const[o,s]=n.split("=").map((e=>e.trim()));e&&!n.includes(`domain=${e}`)||(t[o]=s)})),t}static clearAll(e,t="/",n=!1){const o=location.hostname.split("."),s=1===o.length&&"localhost"===o[0]?"":o.length>1?o.slice(1).join("."):location.hostname,i=JsCookieEncrypt.getAllCookies(e);if(Object.keys(i).forEach((n=>{let o=`${n}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=${t}`;e&&(o+=`; domain=${e}`),document.cookie=o})),n){const n=JsCookieEncrypt.getAllCookies(s);Object.keys(n).forEach((n=>{let o=`${n}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=${t}`;e&&(o+=`; domain=${s}`),document.cookie=o}))}}get(e){try{if("undefined"==typeof document)return null;const t=document.cookie.match(new RegExp("(^| )"+this.storageKey+"=([^;]+)")),n=t?t[2]:null;if(!n)return null;let o;return o=this.encryptByDefault?JSON.parse(this.crypto.decrypt(n)):JSON.parse(n),e&&o&&e in o?o[e]||null:o}catch(e){return console.error("Failed to retrieve or parse cookie data:",e),JsCookieEncrypt.clearAll(void 0,"/",!0),null}}update(e,t={}){if("undefined"==typeof document)return;const n=this.get()||{},o=Object.assign(Object.assign({},n),e);this.set(o,t)}deleteFields(e){if("undefined"==typeof document)return;const t=this.get()||{};e.forEach((e=>delete t[e])),this.set(t)}clear(e={}){const t=Object.assign(Object.assign({},this.defaultOptions),e);let n=`${encodeURIComponent(this.storageKey)}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=${t.path||"/"}`;this.appendCookieOptions(n,t),document.cookie=n}appendCookieOptions(e,t){if(t.expires){e+=`; expires=${("number"==typeof t.expires?new Date(Date.now()+1e3*t.expires):t.expires).toUTCString()}`}return t.path&&(e+=`; path=${t.path}`),t.domain&&(e+=`; domain=${t.domain}`),t.secure&&(e+="; secure"),t.sameSite&&(e+=`; samesite=${t.sameSite}`),t.httpOnly&&(e+="; httponly"),e}}exports.JsCookieEncrypt=JsCookieEncrypt,exports.default=JsCookieEncrypt;
//# sourceMappingURL=js-cookie-encrypt.js.map